# GAS-RecipeSuggester

Google Apps Script (GAS) と Gemini API を活用した、冷蔵庫にある食材から献立を提案し、LINEに通知する自動化ツールです。食材の無駄をなくし、日々の献立決定をサポートします。

---

## 目次

* [1. 概要](#1-概要)
* [2. 特徴](#2-特徴)
* [3. システム構成](#3-システム構成)
* [4. セットアップ](#4-セットアップ)
    * [4.1. 前提条件](#41-前提条件)
    * [4.2. リポジトリのクローンとclaspの初期設定](#42-リポジトリのクローンとclaspの初期設定)
    * [4.3. Google スプレッドシートの準備](#43-google-スプレッドシートの準備)
    * [4.4. APIキーの取得と設定](#44-apiキーの取得と設定)
    * [4.5. Gemini CLIのセットアップ](#45-gemini-cliのセットアップ)
    * [4.6. GASトリガーの設定](#46-gasトリガーの設定)
* [5. 使い方](#5-使い方)
* [6. 開発](#6-開発)
* [7. トラブルシューティング](#7-トラブルシューティング)
* [8. ライセンス](#8-ライセンス)

---

## 1. 概要

`GAS-RecipeSuggester` は、Google Apps Script (GAS) を利用して、ユーザーがGoogle スプレッドシートに登録した食材と調味料を基に、Google Gemini API が最適な献立を提案し、その情報をLINEに自動通知するアプリケーションです。毎日の献立を考える手間を省き、冷蔵庫の食材を無駄なく使い切ることを目指します。

このプロジェクトは、GASとGemini APIの無料枠、LINE Notifyの無料サービスを利用することで、**ノーコストでの運用**が可能です。

---

## 2. 特徴

* **食材・調味料管理**: Google スプレッドシートで冷蔵庫の食材や常備調味料を簡単に管理できます。
    * **優先消費フラグ**: 特定の食材を優先的に消費するよう提案を促せます。
* **AIによる献立提案**:
    * Google Gemini API が、登録された食材・調味料の中から最適な献立を提案します。
    * **辛いもの、ネギ、ニンニク不使用**の制約を遵守して提案します。
    * **食べる人数**を指定して、適切な分量の献立を提案します。
* **LINE通知**: 提案された献立は、毎日指定した時間にLINEへ自動通知されます。
    * 提案されたメニューの**Google検索レシピURL**を同時に提供し、すぐに調理方法を調べられます。
* **献立履歴記録**: 提案された献立は自動的にスプレッドシートに記録され、過去の献立を簡単に振り返ることができます。
* **週次買い物リスト**: 週に一度、現在の食材在庫を考慮した買い物リストをGeminiが提案し、LINEに通知します。
* **ノーコスト運用**: Google Apps Script, Google Gemini APIの無料枠, LINE Notifyのみで運用可能です。

---

## 3. システム構成

`GAS-RecipeSuggester` は以下の主要コンポーネントで構成されます。

* **Google スプレッドシート**:
    * `食材リスト`: 現在の食材在庫、カテゴリ、数量、消費期限、優先消費フラグを管理。
    * `調味料リスト`: 常備調味料、種類、残量目安を管理。
    * `設定`: 通知時刻、食べる人数、APIキーなどのアプリ設定を管理。
    * `献立履歴`: 提案された献立の履歴を自動記録。
* **Google Apps Script (GAS)**:
    * スプレッドシートからのデータ読み込み、Gemini APIへのリクエスト、LINE Notifyへの通知、献立履歴記録、買い物リスト生成といったロジックを実行するバックエンド。
* **Google Gemini API**:
    * GASからのプロンプト（食材、調味料、制約など）に基づき、AIが献立や買い物リストを生成。
* **LINE Notify**:
    * GASから送られた献立情報や買い物リストをLINEに通知。

---

## 4. セットアップ

### 4.1. 前提条件

* Google アカウント
* LINE アカウント
* Node.js と npm (claspのインストールに必要)
* Python と pip (Gemini CLIのインストールに必要)

### 4.2. リポジトリのクローンとclaspの初期設定

1.  **リポジトリをクローンします:**
    ```bash
    git clone [https://github.com/your-username/GAS-RecipeSuggester.git](https://github.com/your-username/GAS-RecipeSuggester.git)
    cd GAS-RecipeSuggester
    ```
    (注意: `your-username` はあなたのGitHubユーザー名に置き換えてください)

2.  **claspをインストールします (初回のみ):**
    ```bash
    npm install -g @google/clasp
    ```

3.  **claspでGoogleアカウントにログインします:**
    ```bash
    clasp login
    ```
    ブラウザが開き、Googleアカウントへのログインと承認を求められます。

4.  **既存のGASプロジェクトをローカルにクローン、または新規作成します:**
    * **既存プロジェクトに紐付ける場合:**
        ```bash
        clasp clone <YOUR_GAS_PROJECT_ID>
        ```
        (Google Driveで新しいGASプロジェクトを作成し、そのプロジェクトIDをコピーしてください)
    * **新規でGASプロジェクトを作成し紐付ける場合:**
        ```bash
        clasp create --title "GAS-RecipeSuggester" --type sheets --rootDir ./src
        ```
        (`src` ディレクトリにGASのコードを置く想定です。必要に応じて変更してください。)

5.  **`.gitignore` ファイルを作成し、設定します:**
    リポジトリのルートに `.gitignore` ファイルを作成し、以下の内容を追加します。
    ```gitignore
    # clasp files
    .clasp.json
    .clasprc

    # Node.js dependencies
    node_modules/

    # Environment variables (if used for local testing)
    .env

    # Logs
    *.log
    ```
    これにより、機密情報や生成ファイルが誤ってGitリポジトリにコミットされるのを防ぎます。

### 4.3. Google スプレッドシートの準備

1.  新しいGoogleスプレッドシートを作成し、名前を `献立サジェストくんデータ` などとします。
2.  以下の4つのシートを作成し、指定のカラムを準備します。
    * `食材リスト` (A:食材名, B:カテゴリ, C:数量, D:消費期限, E:優先消費)
    * `調味料リスト` (A:調味料名, B:種類, C:残量目安)
    * `設定` (A:設定項目, B:設定値) - `通知時刻`, `食べる人数`, `献立提案数`, `買い物リスト通知曜日`, `買い物リスト通知時刻` を手動で入力してください。
    * `献立履歴` (A:日付, B:メニュー名, C:主要食材, D:調理時間, E:調理手順, F:レシピURL, G:提案理由)
3.  このスプレッドシートのURLから**ID**をコピーして控えておきます。
    (例: `https://docs.google.com/spreadsheets/d/`**`ここにIDが入ります`**`/edit#gid=0`)

### 4.4. APIキーの取得と設定

セキュリティのため、APIキーはGASの**スクリプトプロパティ**で管理します。

1.  **Google AI Studio で Gemini API キーを取得:**
    * [Google AI Studio](https://aistudio.google.com/) にアクセスし、ログインします。
    * 左側のメニューまたは画面中央の「**Get API Key**」から新しいAPIキーを発行し、コピーします。

2.  **LINE Notify のアクセストークンを取得:**
    * LINEで「LINE Notify」を友達追加します。
    * [LINE Notify公式サイト](https://notify-bot.line.me/ja/) にログインします。
    * マイページから「アクセストークンを発行する」を選択し、トークン名を入力、通知を送りたいトークルーム（「LINE Notifyとの1対1で受け取る」またはグループ）を選択して発行します。発行されたトークンをコピーします。

3.  **GASスクリプトプロパティに設定:**
    * claspで開いたGASプロジェクトのコードエディタ（またはGoogle Drive上のGASプロジェクトのスクリプトエディタ）を開きます。
    * 左側のメニューで「**プロジェクトの設定**」（歯車アイコン）をクリックします。
    * 「**スクリプト プロパティ**」セクションまでスクロールし、「**スクリプト プロパティを追加**」をクリックします。
        * **キー**: `GEMINI_API_KEY` , **値**: (取得したGemini APIキー)
        * **キー**: `LINE_NOTIFY_TOKEN` , **値**: (取得したLINE Notifyトークン)
        * **キー**: `SPREADSHEET_ID` , **値**: (準備したスプレッドシートのID)
    * それぞれ追加して「プロパティを保存」をクリックします。

### 4.5. Gemini CLIのセットアップ

プロンプトのテストやモデルの動作確認に便利です。

1.  **Gemini CLIをインストールします:**
    ```bash
    pip install -U google-generativeai
    ```
2.  **Gemini CLIを設定します:**
    ```bash
    gemini configure
    ```
    プロンプトに従って、先ほど取得したGemini APIキーを入力します。

### 4.6. GASトリガーの設定

GASのコードを `clasp push` でデプロイした後、自動実行するためのトリガーを設定します。

1.  GASプロジェクトのスクリプトエディタを開きます。
2.  左側のメニューで「**トリガー**」（時計アイコン）をクリックします。
3.  「**トリガーを追加**」をクリックし、以下の設定で2つのトリガーを作成します。

    * **献立提案・通知トリガー:**
        * 実行する関数を選択: `suggestAndNotifyMenu`
        * イベントのソースを選択: `時間主導型`
        * 時間ベースのタイプを選択: `日付ベースのタイマー`
        * 時間を選択: 「設定」シートで指定した時刻に合わせる (例: `午後5時～6時`)
    * **買い物リスト生成・通知トリガー:**
        * 実行する関数を選択: `generateAndNotifyShoppingList`
        * イベントのソースを選択: `時間主導型`
        * 時間ベースのタイプを選択: `週ベースのタイマー`
        * 曜日を選択: 「設定」シートで指定した曜日 (例: `月曜日`)
        * 時間を選択: 「設定」シートで指定した時刻に合わせる (例: `午前9時～10時`)

---

## 5. 使い方

1.  **食材と調味料の登録**:
    * 準備したGoogleスプレッドシートを開き、「**食材リスト**」シートと「**調味料リスト**」シートに、現在冷蔵庫にある食材や常備している調味料を入力します。
    * 「**優先消費**」にチェックを入れると、その食材が献立提案で優先的に使われるようになります。
2.  **設定の調整**:
    * 「**設定**」シートで、LINE通知の時刻や献立を食べる人数などを調整します。
3.  **通知の確認**:
    * 設定した時刻になると、LINE Notifyからその日の献立提案が届きます。
    * 提案された献立は「**献立履歴**」シートに自動で記録されます。
    * 週に一度、設定した曜日には買い物リストも通知されます。

---

## 6. 開発

このプロジェクトは `clasp` を使用してローカルでの開発とGitHubでのバージョン管理をサポートしています。

### 開発フロー

1.  ローカルでコードを変更します。
2.  `clasp push` コマンドでGASプロジェクトにデプロイします。
3.  テストはGASのログ (`Logger.log()`) や、必要に応じて直接関数を実行して行います。
4.  Gemini APIへのプロンプト調整は、`Gemini CLI` を使用すると効率的です。
    ```bash
    # プロンプトのテスト例
    gemini generate-content "鶏肉と卵で簡単に作れる夜ご飯のメニューを3つ提案してください。辛いものはNG。"
    ```

### ドキュメント

より詳細な情報や関数定義については、`docs/` ディレクトリ内のドキュメントを参照してください。

* `docs/spreadsheet_layout.md`: 各シートの詳細なカラム定義と入力例。
* `docs/gas_functions.md`: 各GAS関数の詳細な説明。
* `docs/gemini_prompts.md`: Geminiへのプロンプト例と調整ポイント。
* `docs/api_keys_and_security.md`: APIキーの取得方法とセキュリティに関する注意点。

---

## 7. トラブルシューティング

* **LINE通知が来ない**:
    * GASトリガーが正しく設定されているか確認してください。
    * GASの実行ログを確認し、エラーが出ていないか確認してください。
    * `LINE_NOTIFY_TOKEN`がスクリプトプロパティに正しく設定されているか確認してください。
    * LINE Notifyが友達追加されているか、またはグループに招待されているか確認してください。
* **献立が提案されない、または不適切な内容**:
    * GASの実行ログを確認し、Gemini API呼び出しでエラーが出ていないか確認してください。
    * `GEMINI_API_KEY`がスクリプトプロパティに正しく設定されているか確認してください。
    * 「食材リスト」「調味料リスト」に十分なデータが登録されているか確認してください。
    * `callGeminiApiForMenu`関数内のプロンプトを再確認し、Gemini CLIでテストしてみてください。
* **スプレッドシートが更新されない**:
    * GASスクリプトがスプレッドシートへのアクセス権限を持っているか確認してください。初回実行時に承認が求められる場合があります。
    * シート名やカラム名がスクリプト内で指定されているものと一致しているか確認してください。

---

## 8. ライセンス

このプロジェクトは **MITライセンス** の下で公開されています。詳細については、リポジトリのルートにある [LICENSE](LICENSE) ファイルを参照してください。
````
